# xiaopukeji
xiaoputao练习md语法，顺便写一个权限相关业务
# 1.权限相关概念
### 1-1 权限的分类
+ 后端权限
  从根本上讲前端只是**视图层的展示**，权限核心是服务器数据变化，后端才是权限的关键，后端权限可以控制某个用户是否能够对数据的**增、删、改、查。**
后端如何知道该请求是哪个用户发过来的
cookie
session
token
后端的权限设计RBAC
用户
角色
权限
+ 前端权限
前端权限的控制本质是控制前端的 试图层的展示和前端所发送的请求，但是只有前端权限控制没有后端权限控制也是不够的。
1.2前端权限的意义
  如果仅仅从修改后台服务器数据层面上来说，确实只在后端做控制就足够了，那为什么还需要从前端进行前端控制呢？
+ 降低非法操作的可能性
  如果页面中有一个按钮，虽然点击最终也不会产生效果，但这个按钮还是可被非法操作，所以可以考虑根据权限，让其直接不显示
+ 尽可能排除不必要的请求，减少服务器压力
  没必要的请求，操作失败的请求，不惧权限的请求，直接不让其发送，请求少了就会减轻服务器压力
+ 提高用户体验
  根据用户具备的权限为用户展现自己权限范围内的应用，避免在界面给用户带来困扰，
# 2.前端权限控制思路
### 2-1 菜单的控制
在用户登入后，会得到权限数据，这个需要后端返回的数据支持，前端根据权限数据，展示对应的菜单，映射出路由列表，点击跳转到相关页面
### 2-2 界面的控制
如果用户没有登入，直接在地址栏访问路由列表地址，则需要跳转到登入界面
如果用户已经登录，可是手动输入非权限内的地址，则跳转404页面
### 2-3 按钮的控制
在某个菜单界面中，还得需要根据权限数据（后台返回当前用户的数据），展示可进行操作的按钮，比如删除，修改，增加
### 2-4 请求和响应的控制
如果用通过非常规操作，比如**通过浏览器调试工具将某些禁用的按钮变成启用状态**，此时发送的请求，也应该被前端所拦截
# 3.VUE的权限控制实现
### 3-1 菜单的控制
+ 拿到登录成功之后的数据(数据结构稍后补上)
  对数据说明
  token对前端用户的状态保持
  rights 该用户具备的权限数据 一级权限对应一级菜单 二级权限对应二级菜单
+ 根据rights中的数据（相当于路由列表），动态渲染左侧菜单栏，由于数据在login.vue组件中拿到，才其他不相关联组件中使用，所以把数据放在vuex中管理（代码稍后上）
 问题一： 刷新页面菜单消失
 菜单数据是登入接口获取的，获取数据后放在vuex中，重新刷新页面vuex中数据初始化，rights变成空数组，因此要将权限数据存储在SessionStorage中并让其和vuex中数据保持同步
 ### 3-2 界面的控制
 1.正常步骤是通过登入界面，登入成功之后跳转到平台管理页面，但是客户如果直接地址栏输入管理平台页面地址，也能进入对应页面，所以应该在某个时机
 判断用户是否登入关键token
   如何判断是否登录 根据登入成功后保存的token
   判断时机 路由导航守卫router.beforeEach
 2. 虽然菜单项被控制了，但是路由信息还是完整的存在于浏览器，比如A用户有三个菜单 B用户有两个菜单 由于此时项目代码路由列表是包含了所有的匹配项
 所以B用户虽然菜单是少了一个，但B用户还是通过地址栏可以访问A用的其他一个菜单页面
 解决方案与分析：路由导航守卫固然可以在每次路由地址发生变化的时候，从vuex中取出rights判断用户将要访问的界面，这个用户到底有没有权限。
 不过从另外一个角度来讲，这个用户不具备权限的路由，是否可以让直接不存在呢？
 问题总结：处理方式 **动态路由**
 + 动态路由
 什么是动态路由：与静态路由相对的路由（王某人瞎几把编的）
 执行过程：登录成功之后，自己组装一个路由列表，动态追加到路由实例中，然后不同用户的路由列表动态变化，这样B用户就不会访问到A用户的第三个路由了，因为
 B的路由列表压根就没有A用户的第三个路由的访问path路径，直接404（自己总结的，感觉是这么回事）
 
 


     
